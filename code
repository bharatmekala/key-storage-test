import boto3

client = boto3.client('elbv2')

listener_arn = 'arn:aws:elasticloadbalancing:region:account-id:listener/app/your-listener'
target_group_arn = 'arn:aws:elasticloadbalancing:region:account-id:targetgroup/your-target-group'
header_name = 'x-api-key'
expected_value = 'abc123'

response = client.create_rule(
    ListenerArn=listener_arn,
    Priority=10,  # Must be unique
    Conditions=[
        {
            'Field': 'http-header',
            'HttpHeaderConfig': {
                'HttpHeaderName': header_name,
                'Values': [expected_value]
            }
        }
    ],
    Actions=[
        {
            'Type': 'forward',
            'TargetGroupArn': target_group_arn
        }
    ]
)

print("Created rule:", response['Rules'][0]['RuleArn'])
